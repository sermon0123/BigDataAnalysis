from __future__ import division
import os
import operator



user_tags={'1': [('Comedy', 0.554), ('Action', 0.446)], '2': [('Drama', 0.565), ('Comedy', 0.435)], '3': [('Sci-Fi', 0.58), ('Action', 0.42)], '4': [('Drama', 0.541), ('Comedy', 0.459)], '5': [('Drama', 0.721), ('Crime', 0.279)], '6': [('Drama', 0.586), ('Comedy', 0.414)], '7': [('Drama', 0.525), ('Action', 0.475)], '8': [('Drama', 0.559), ('Thriller', 0.441)], '9': [('Comedy', 0.512), ('Drama', 0.488)], '10': [('Comedy', 0.518), ('Drama', 0.482)], '11': [('Drama', 0.531), ('Action', 0.469)], '12': [('Romance', 0.516), ('Comedy', 0.484)], '13': [('Drama', 0.547), ('Action', 0.453)], '14': [('Drama', 0.691), ('Thriller', 0.309)], '15': [('Drama', 0.519), ('Sci-Fi', 0.481)], '16': [('Drama', 0.678), ('Thriller', 0.322)], '17': [('Drama', 0.639), ('Crime', 0.361)], '18': [('Drama', 0.609), ('Crime', 0.391)], '19': [('Comedy', 0.722), ('Action', 0.278)], '20': [('Children', 0.528), ('Comedy', 0.472)], '21': [('Adventure', 0.505), ('Action', 0.495)], '22': [('Drama', 0.695), ('Comedy', 0.305)], '23': [('Drama', 0.666), ('Mystery', 0.334)], '24': [('Drama', 0.547), ('Action', 0.453)], '25': [('Adventure', 0.505), ('Drama', 0.495)], '26': [('Thriller', 0.722), ('Crime', 0.278)], '27': [('Drama', 0.546), ('Adventure', 0.454)], '28': [('Drama', 0.679), ('Action', 0.321)], '29': [('Drama', 0.666), ('Action', 0.334)], '30': [('Action', 0.538), ('Adventure', 0.462)], '31': [('Comedy', 0.566), ('Drama', 0.434)], '32': [('Drama', 0.617), ('Comedy', 0.383)], '33': [('Drama', 0.715), ('Comedy', 0.285)], '34': [('Action', 0.636), ('Comedy', 0.364)], '35': [('Drama', 0.604), ('Comedy', 0.396)], '36': [('Drama', 0.578), ('Comedy', 0.422)], '37': [('Thriller', 0.54), ('Comedy', 0.46)], '38': [('Drama', 0.61), ('Comedy', 0.39)], '39': [('Drama', 0.554), ('Crime', 0.446)], '40': [('Drama', 0.655), ('Comedy', 0.345)], '41': [('Drama', 0.646), ('Comedy', 0.354)], '42': [('Comedy', 0.523), ('Drama', 0.477)], '43': [('Comedy', 0.533), ('Drama', 0.467)], '44': [('Comedy', 0.604), ('Drama', 0.396)], '45': [('Comedy', 0.609), ('Drama', 0.391)], '46': [('Thriller', 0.564), ('Action', 0.436)], '47': [('Drama', 0.874), ('Crime', 0.126)], '48': [('Action', 0.507), ('Sci-Fi', 0.493)], '49': [('Drama', 0.607), ('Sci-Fi', 0.393)], '50': [('Drama', 0.804), ('Fantasy', 0.196)], '51': [('Comedy', 0.567), ('Drama', 0.433)], '52': [('Action', 0.503), ('Drama', 0.497)], '53': [('Drama', 0.6), ('Comedy', 0.4)], '54': [('Crime', 0.526), ('Drama', 0.474)], '55': [('Drama', 0.503), ('Crime', 0.497)], '56': [('Comedy', 0.535), ('Thriller', 0.465)], '57': [('Comedy', 0.551), ('Drama', 0.449)], '58': [('Drama', 0.593), ('Comedy', 0.407)], '59': [('Drama', 0.656), ('Thriller', 0.344)], '60': [('Drama', 0.78), ('Crime', 0.22)], '61': [('Drama', 0.617), ('Crime', 0.383)], '62': [('Drama', 0.629), ('Action', 0.371)], '63': [('Comedy', 0.609), ('Drama', 0.391)], '64': [('Drama', 0.609), ('Comedy', 0.391)], '65': [('Drama', 0.728), ('Crime', 0.272)], '66': [('Drama', 0.564), ('Comedy', 0.436)], '67': [('Action', 0.538), ('Comedy', 0.462)], '68': [('Comedy', 0.501), ('Action', 0.499)], '69': [('Drama', 0.555), ('Action', 0.445)], '70': [('Drama', 0.817), ('Comedy', 0.183)], '71': [('Action', 0.582), ('Thriller', 0.418)], '72': [('Drama', 0.618), ('Thriller', 0.382)], '73': [('Comedy', 0.542), ('Drama', 0.458)], '74': [('Drama', 0.852), ('Thriller', 0.148)], '75': [('Action', 0.55), ('Adventure', 0.45)], '76': [('Drama', 0.544), ('Comedy', 0.456)], '77': [('Adventure', 0.514), ('Action', 0.486)], '78': [('Comedy', 0.547), ('Action', 0.453)], '79': [('Action', 0.596), ('Drama', 0.404)], '80': [('Thriller', 0.624), ('Action', 0.376)], '81': [('Sci-Fi', 0.54), ('Thriller', 0.46)], '82': [('Comedy', 0.525), ('Action', 0.475)], '83': [('Drama', 0.793), ('Action', 0.207)], '84': [('Drama', 0.742), ('Comedy', 0.258)], '85': [('Drama', 0.85), ('Comedy', 0.15)], '86': [('Drama', 0.543), ('Adventure', 0.457)], '87': [('Comedy', 0.549), ('Drama', 0.451)], '88': [('Drama', 0.643), ('Crime', 0.357)], '89': [('Comedy', 0.837), ('Animation', 0.163)], '90': [('Drama', 0.677), ('Comedy', 0.323)], '91': [('Thriller', 0.51), ('Action', 0.49)], '92': [('Drama', 0.564), ('Comedy', 0.436)], '93': [('Adventure', 0.533), ('Action', 0.467)], '94': [('Drama', 0.56), ('Thriller', 0.44)], '95': [('Drama', 0.581), ('Comedy', 0.419)], '96': [('Drama', 0.544), ('Action', 0.456)], '97': [('Action', 0.597), ('Drama', 0.403)], '98': [('Drama', 0.622), ('Comedy', 0.378)], '99': [('Comedy', 0.529), ('Drama', 0.471)], '100': [('Drama', 0.519), ('Comedy', 0.481)], '101': [('Drama', 0.632), ('Comedy', 0.368)], '102': [('Comedy', 0.549), ('Thriller', 0.451)], '103': [('Drama', 0.656), ('Comedy', 0.344)], '104': [('Comedy', 0.634), ('Romance', 0.366)], '105': [('Comedy', 0.51), ('Drama', 0.49)], '106': [('Adventure', 0.529), ('Fantasy', 0.471)], '107': [('Drama', 0.645), ('Comedy', 0.355)], '108': [('Drama', 0.611), ('Romance', 0.389)], '109': [('Drama', 0.695), ('Crime', 0.305)], '110': [('Drama', 0.646), ('Comedy', 0.354)], '111': [('Comedy', 0.835), ('Drama', 0.165)], '112': [('Drama', 0.577), ('Action', 0.423)], '113': [('Drama', 0.605), ('Romance', 0.395)], '114': [('Adventure', 0.554), ('Fantasy', 0.446)], '115': [('Comedy', 0.576), ('Action', 0.424)], '116': [('Action', 0.518), ('Romance', 0.482)], '117': [('Drama', 0.597), ('Comedy', 0.403)], '118': [('Drama', 0.71), ('Crime', 0.29)], '119': [('Drama', 0.591), ('Action', 0.409)], '120': [('Comedy', 0.523), ('Adventure', 0.477)], '121': [('Drama', 0.601), ('Comedy', 0.399)], '122': [('Comedy', 0.547), ('Drama', 0.453)], '123': [('Drama', 0.561), ('Thriller', 0.439)], '124': [('Drama', 0.693), ('Comedy', 0.307)], '125': [('Drama', 0.525), ('Comedy', 0.475)], '126': [('Drama', 0.503), ('Thriller', 0.497)], '127': [('Comedy', 0.543), ('Drama', 0.457)], '128': [('Drama', 0.553), ('Comedy', 0.447)], '129': [('Action', 0.572), ('Adventure', 0.428)], '130': [('Drama', 0.545), ('Comedy', 0.455)], '131': [('Drama', 0.6), ('Crime', 0.4)], '132': [('Drama', 0.668), ('Romance', 0.332)], '133': [('Thriller', 0.595), ('Drama', 0.405)], '134': [('Drama', 0.575), ('Thriller', 0.425)], '135': [('Comedy', 0.581), ('Drama', 0.419)], '136': [('Drama', 0.515), ('Comedy', 0.485)], '137': [('Drama', 0.734), ('Comedy', 0.266)], '138': [('Drama', 0.504), ('Comedy', 0.496)], '139': [('Adventure', 0.599), ('Action', 0.401)], '140': [('Drama', 0.768), ('Action', 0.232)], '141': [('Comedy', 0.625), ('Drama', 0.375)], '142': [('Drama', 0.58), ('Thriller', 0.42)], '143': [('Comedy', 0.601), ('Romance', 0.399)], '144': [('Drama', 0.617), ('Romance', 0.383)], '145': [('Thriller', 0.516), ('Drama', 0.484)], '146': [('Comedy', 0.517), ('Drama', 0.483)], '147': [('Comedy', 0.746), ('Crime', 0.254)], '148': [('Adventure', 0.58), ('Fantasy', 0.42)], '149': [('Sci-Fi', 0.652), ('Action', 0.348)], '150': [('Thriller', 0.559), ('Drama', 0.441)], '151': [('Comedy', 0.786), ('Drama', 0.214)], '152': [('Drama', 0.727), ('Thriller', 0.273)], '153': [('Drama', 0.754), ('Romance', 0.246)], '154': [('Sci-Fi', 0.509), ('Action', 0.491)], '155': [('Comedy', 0.628), ('Action', 0.372)], '156': [('Drama', 0.642), ('Comedy', 0.358)], '157': [('Comedy', 0.542), ('Drama', 0.458)], '158': [('Action', 0.521), ('Thriller', 0.479)], '159': [('Drama', 0.562), ('Comedy', 0.438)], '160': [('Drama', 0.655), ('Comedy', 0.345)], '161': [('Comedy', 0.662), ('Children', 0.338)], '162': [('Drama', 0.772), ('Romance', 0.228)], '163': [('Drama', 0.583), ('Comedy', 0.417)], '164': [('Action', 0.665), ('Adventure', 0.335)], '165': [('Action', 0.597), ('Adventure', 0.403)], '166': [('Drama', 0.647), ('Action', 0.353)], '167': [('Comedy', 0.595), ('Adventure', 0.405)], '168': [('Drama', 0.755), ('Comedy', 0.245)], '169': [('Comedy', 0.555), ('Drama', 0.445)], '170': [('Drama', 0.661), ('Romance', 0.339)], '171': [('Drama', 0.601), ('Comedy', 0.399)], '172': [('Comedy', 0.538), ('Drama', 0.462)], '173': [('Drama', 0.513), ('Comedy', 0.487)], '174': [('Drama', 0.502), ('Comedy', 0.498)], '175': [('Drama', 0.627), ('Romance', 0.373)], '176': [('Thriller', 0.544), ('Action', 0.456)], '177': [('Drama', 0.615), ('Comedy', 0.385)], '178': [('Drama', 0.65), ('Thriller', 0.35)], '179': [('Thriller', 0.553), ('Drama', 0.447)], '180': [('Adventure', 0.542), ('Comedy', 0.458)], '181': [('Drama', 0.53), ('Thriller', 0.47)], '182': [('Drama', 0.711), ('Comedy', 0.289)], '183': [('Action', 0.688), ('Thriller', 0.312)], '184': [('Drama', 0.618), ('Sci-Fi', 0.382)], '185': [('Drama', 0.58), ('Romance', 0.42)], '186': [('Sci-Fi', 0.514), ('Adventure', 0.486)], '187': [('Drama', 0.696), ('Thriller', 0.304)], '188': [('Comedy', 0.553), ('Drama', 0.447)], '189': [('Drama', 0.612), ('Crime', 0.388)], '190': [('Drama', 0.685), ('Comedy', 0.315)], '191': [('Drama', 0.704), ('Comedy', 0.296)], '192': [('Thriller', 0.506), ('Drama', 0.494)], '193': [('Drama', 0.707), ('Adventure', 0.293)], '194': [('Comedy', 0.531), ('Drama', 0.469)], '195': [('Drama', 0.664), ('Comedy', 0.336)], '196': [('Drama', 0.551), ('Action', 0.449)], '197': [('Drama', 0.552), ('Action', 0.448)], '198': [('Drama', 0.757), ('Romance', 0.243)], '199': [('Drama', 0.64), ('Comedy', 0.36)], '200': [('Comedy', 0.634), ('Drama', 0.366)], '201': [('Comedy', 0.61), ('Drama', 0.39)], '202': [('Drama', 0.712), ('Comedy', 0.288)], '203': [('Drama', 0.555), ('Action', 0.445)], '204': [('Drama', 0.617), ('Thriller', 0.383)], '205': [('Drama', 0.526), ('Action', 0.474)], '206': [('Drama', 0.663), ('Romance', 0.337)], '207': [('Thriller', 0.561), ('Adventure', 0.439)], '208': [('Action', 0.638), ('Drama', 0.362)], '209': [('Drama', 0.628), ('Action', 0.372)], '210': [('Sci-Fi', 0.506), ('Adventure', 0.494)], '211': [('Action', 0.519), ('Drama', 0.481)], '212': [('Comedy', 0.542), ('Drama', 0.458)], '213': [('Drama', 0.555), ('Action', 0.445)], '214': [('Drama', 0.5), ('Romance', 0.5)], '215': [('Drama', 0.643), ('Comedy', 0.357)], '216': [('Comedy', 0.673), ('Drama', 0.327)], '217': [('Comedy', 0.535), ('Action', 0.465)], '218': [('Comedy', 0.597), ('Drama', 0.403)], '219': [('Comedy', 0.578), ('Drama', 0.422)], '220': [('Comedy', 0.543), ('Action', 0.457)], '221': [('Drama', 0.683), ('Comedy', 0.317)], '222': [('Drama', 0.574), ('Comedy', 0.426)], '223': [('Drama', 0.559), ('Comedy', 0.441)], '224': [('Comedy', 0.643), ('Romance', 0.357)], '225': [('Comedy', 0.785), ('Horror', 0.215)], '226': [('Comedy', 0.636), ('Drama', 0.364)], '227': [('Drama', 0.693), ('Thriller', 0.307)], '228': [('Sci-Fi', 0.505), ('Thriller', 0.495)], '229': [('Drama', 0.616), ('Comedy', 0.384)], '230': [('Comedy', 0.536), ('Action', 0.464)], '231': [('Action', 0.589), ('Sci-Fi', 0.411)], '232': [('Drama', 0.721), ('Comedy', 0.279)], '233': [('Drama', 0.745), ('Crime', 0.255)], '234': [('Adventure', 0.542), ('Action', 0.458)], '235': [('Drama', 0.615), ('Comedy', 0.385)], '236': [('Comedy', 0.598), ('Horror', 0.402)], '237': [('Drama', 0.606), ('Thriller', 0.394)], '238': [('Drama', 0.546), ('Thriller', 0.454)], '239': [('Drama', 0.606), ('Action', 0.394)], '240': [('Comedy', 0.683), ('Drama', 0.317)], '241': [('Drama', 0.785), ('Romance', 0.215)], '242': [('Thriller', 0.55), ('Drama', 0.45)], '243': [('Action', 0.58), ('Thriller', 0.42)], '244': [('Drama', 0.553), ('Action', 0.447)], '245': [('Documentary', 0.909), ('Adventure', 0.091)], '246': [('Drama', 0.649), ('Action', 0.351)], '247': [('Drama', 0.622), ('Action', 0.378)], '248': [('Action', 0.527), ('Adventure', 0.473)], '249': [('Drama', 0.534), ('Comedy', 0.466)], '250': [('Drama', 0.774), ('Romance', 0.226)], '251': [('Drama', 0.661), ('Thriller', 0.339)], '252': [('Drama', 0.542), ('Comedy', 0.458)], '253': [('Drama', 0.668), ('Documentary', 0.332)], '254': [('Drama', 0.641), ('Thriller', 0.359)], '255': [('Comedy', 0.811), ('Action', 0.189)], '256': [('Comedy', 0.537), ('Drama', 0.463)], '257': [('Comedy', 0.596), ('Action', 0.404)], '258': [('Drama', 0.698), ('Crime', 0.302)], '259': [('Comedy', 0.573), ('Drama', 0.427)], '260': [('Drama', 0.563), ('Comedy', 0.437)], '261': [('Drama', 0.695), ('Crime', 0.305)], '262': [('Drama', 0.74), ('Romance', 0.26)], '263': [('Drama', 0.618), ('Romance', 0.382)], '264': [('Adventure', 0.527), ('Drama', 0.473)], '265': [('Drama', 0.653), ('Sci-Fi', 0.347)], '266': [('Comedy', 0.655), ('Drama', 0.345)], '267': [('Action', 0.514), ('Sci-Fi', 0.486)], '268': [('Drama', 0.52), ('Comedy', 0.48)], '269': [('Thriller', 0.505), ('Drama', 0.495)], '270': [('Drama', 0.725), ('Romance', 0.275)], '271': [('Drama', 0.595), ('Comedy', 0.405)], '272': [('Sci-Fi', 0.506), ('Drama', 0.494)], '273': [('Comedy', 0.65), ('Drama', 0.35)], '274': [('Comedy', 0.501), ('Drama', 0.499)], '275': [('Drama', 0.551), ('Comedy', 0.449)], '276': [('Comedy', 0.759), ('Adventure', 0.241)], '277': [('Action', 0.515), ('Thriller', 0.485)], '278': [('Drama', 0.602), ('Comedy', 0.398)], '279': [('Action', 0.568), ('Drama', 0.432)], '280': [('Drama', 0.527), ('Comedy', 0.473)], '281': [('Comedy', 0.563), ('Drama', 0.437)], '282': [('Drama', 0.562), ('Comedy', 0.438)], '283': [('Comedy', 0.615), ('Drama', 0.385)], '284': [('Comedy', 0.698), ('Action', 0.302)], '285': [('Drama', 0.756), ('Comedy', 0.244)], '286': [('Drama', 0.549), ('Thriller', 0.451)], '287': [('Drama', 0.509), ('Comedy', 0.491)], '288': [('Drama', 0.524), ('Comedy', 0.476)], '289': [('Drama', 0.621), ('Comedy', 0.379)], '290': [('Drama', 0.775), ('Comedy', 0.225)], '291': [('Adventure', 0.627), ('Fantasy', 0.373)], '292': [('Action', 0.518), ('Adventure', 0.482)], '293': [('Drama', 0.8), ('Crime', 0.2)], '294': [('Comedy', 0.781), ('Drama', 0.219)], '295': [('Drama', 0.558), ('Crime', 0.442)], '296': [('Drama', 0.676), ('War', 0.324)], '297': [('Thriller', 0.609), ('Crime', 0.391)], '298': [('Comedy', 0.62), ('Action', 0.38)], '299': [('Action', 0.518), ('Horror', 0.482)], '300': [('Drama', 0.79), ('Thriller', 0.21)], '301': [('Drama', 0.681), ('Thriller', 0.319)], '302': [('Drama', 0.613), ('Thriller', 0.387)], '303': [('Sci-Fi', 0.601), ('Action', 0.399)], '304': [('Drama', 0.603), ('Action', 0.397)], '305': [('Drama', 0.604), ('Action', 0.396)], '306': [('Comedy', 0.657), ('Horror', 0.343)], '307': [('Comedy', 0.545), ('Drama', 0.455)], '308': [('Adventure', 0.559), ('Drama', 0.441)], '309': [('Drama', 0.841), ('Thriller', 0.159)], '310': [('Comedy', 0.55), ('Drama', 0.45)], '311': [('Drama', 0.583), ('Horror', 0.417)], '312': [('Drama', 0.633), ('Sci-Fi', 0.367)], '313': [('Action', 0.514), ('Thriller', 0.486)], '314': [('Drama', 0.624), ('Comedy', 0.376)], '315': [('Drama', 0.722), ('Romance', 0.278)], '316': [('Comedy', 0.638), ('Thriller', 0.362)], '317': [('Drama', 0.645), ('Crime', 0.355)], '318': [('Documentary', 0.511), ('Drama', 0.489)], '319': [('Drama', 0.749), ('Romance', 0.251)], '320': [('Action', 0.711), ('Drama', 0.289)], '321': [('Comedy', 0.506), ('Drama', 0.494)], '322': [('Drama', 0.624), ('Comedy', 0.376)], '323': [('Drama', 0.692), ('Comedy', 0.308)], '324': [('Drama', 0.528), ('Comedy', 0.472)], '325': [('Drama', 0.664), ('Comedy', 0.336)], '326': [('Drama', 0.74), ('Thriller', 0.26)], '327': [('Comedy', 0.704), ('Drama', 0.296)], '328': [('Drama', 0.518), ('Comedy', 0.482)], '329': [('Drama', 0.688), ('Comedy', 0.312)], '330': [('Drama', 0.549), ('Comedy', 0.451)], '331': [('Drama', 0.638), ('Comedy', 0.362)], '332': [('Drama', 0.734), ('Crime', 0.266)], '333': [('Drama', 0.545), ('Comedy', 0.455)], '334': [('Comedy', 0.602), ('Romance', 0.398)], '335': [('Comedy', 0.556), ('Action', 0.444)], '336': [('Drama', 0.669), ('Comedy', 0.331)], '337': [('Drama', 0.609), ('Thriller', 0.391)], '338': [('Drama', 0.572), ('Crime', 0.428)], '339': [('Drama', 0.72), ('Thriller', 0.28)], '340': [('Thriller', 0.517), ('Action', 0.483)], '341': [('Comedy', 0.73), ('Action', 0.27)], '342': [('Drama', 0.506), ('Comedy', 0.494)], '343': [('Drama', 0.611), ('Crime', 0.389)], '344': [('Action', 0.539), ('Adventure', 0.461)], '345': [('Drama', 0.608), ('Comedy', 0.392)], '346': [('Drama', 0.788), ('Thriller', 0.212)], '347': [('Comedy', 0.611), ('Romance', 0.389)], '348': [('Drama', 0.666), ('Crime', 0.334)], '349': [('Drama', 0.583), ('Comedy', 0.417)], '350': [('Sci-Fi', 0.52), ('Action', 0.48)], '351': [('Drama', 0.691), ('Thriller', 0.309)], '352': [('Drama', 0.59), ('Thriller', 0.41)], '353': [('Comedy', 0.528), ('Thriller', 0.472)], '354': [('Drama', 0.626), ('Action', 0.374)], '355': [('Comedy', 0.523), ('Action', 0.477)], '356': [('Comedy', 0.575), ('Drama', 0.425)], '357': [('Drama', 0.6), ('Comedy', 0.4)], '358': [('Romance', 0.56), ('Drama', 0.44)], '359': [('Drama', 0.744), ('Romance', 0.256)], '360': [('Thriller', 0.564), ('Drama', 0.436)], '361': [('Comedy', 0.591), ('Action', 0.409)], '362': [('Drama', 0.571), ('Crime', 0.429)], '363': [('Drama', 0.526), ('Comedy', 0.474)], '364': [('Thriller', 0.572), ('Action', 0.428)], '365': [('Comedy', 0.767), ('Drama', 0.233)], '366': [('Action', 0.524), ('Drama', 0.476)], '367': [('Comedy', 0.52), ('Drama', 0.48)], '368': [('Drama', 0.73), ('Action', 0.27)], '369': [('Comedy', 0.671), ('Drama', 0.329)], '370': [('Comedy', 0.652), ('Action', 0.348)], '371': [('Adventure', 0.503), ('Drama', 0.497)], '372': [('Drama', 0.682), ('Thriller', 0.318)], '373': [('Drama', 0.763), ('Thriller', 0.237)], '374': [('Thriller', 0.505), ('Comedy', 0.495)], '375': [('Drama', 0.525), ('Comedy', 0.475)], '376': [('Action', 0.564), ('Thriller', 0.436)], '377': [('Drama', 0.551), ('Sci-Fi', 0.449)], '378': [('Drama', 0.67), ('Crime', 0.33)], '379': [('Drama', 0.534), ('Thriller', 0.466)], '380': [('Action', 0.594), ('Comedy', 0.406)], '381': [('Drama', 0.566), ('Comedy', 0.434)], '382': [('Adventure', 0.546), ('Drama', 0.454)], '383': [('Drama', 0.804), ('Comedy', 0.196)], '384': [('Comedy', 0.528), ('Drama', 0.472)], '385': [('Drama', 0.535), ('Comedy', 0.465)], '386': [('Crime', 0.581), ('Western', 0.419)], '387': [('Drama', 0.71), ('Comedy', 0.29)], '388': [('Comedy', 0.584), ('Adventure', 0.416)], '389': [('Comedy', 0.543), ('Thriller', 0.457)], '390': [('Drama', 0.776), ('Romance', 0.224)], '391': [('Drama', 0.691), ('Comedy', 0.309)], '392': [('Drama', 0.566), ('Comedy', 0.434)], '393': [('Action', 0.543), ('Adventure', 0.457)], '394': [('Thriller', 0.561), ('Drama', 0.439)], '395': [('Action', 0.508), ('Comedy', 0.492)], '396': [('Drama', 0.611), ('Crime', 0.389)], '397': [('Drama', 0.587), ('Comedy', 0.413)], '398': [('Drama', 0.565), ('Comedy', 0.435)], '399': [('Adventure', 0.591), ('Action', 0.409)], '400': [('Drama', 0.592), ('Crime', 0.408)], '401': [('Animation', 0.533), ('Children', 0.467)], '402': [('Thriller', 0.515), ('Action', 0.485)], '403': [('Drama', 0.643), ('Crime', 0.357)], '404': [('Drama', 0.63), ('Comedy', 0.37)], '405': [('Drama', 0.69), ('Thriller', 0.31)], '406': [('Comedy', 0.645), ('Drama', 0.355)], '407': [('Action', 0.512), ('Adventure', 0.488)], '408': [('Comedy', 0.53), ('Action', 0.47)], '409': [('Comedy', 0.592), ('Drama', 0.408)], '410': [('Drama', 0.538), ('Comedy', 0.462)], '411': [('Drama', 0.658), ('Thriller', 0.342)], '412': [('Comedy', 0.611), ('Drama', 0.389)], '413': [('Drama', 0.598), ('Crime', 0.402)], '414': [('Drama', 0.664), ('Comedy', 0.336)], '415': [('Drama', 0.615), ('Comedy', 0.385)], '416': [('Drama', 0.609), ('Comedy', 0.391)], '417': [('Drama', 0.688), ('Thriller', 0.312)], '418': [('Drama', 0.748), ('Comedy', 0.252)], '419': [('Drama', 0.622), ('Thriller', 0.378)], '420': [('Drama', 0.601), ('Comedy', 0.399)], '421': [('Drama', 0.837), ('Romance', 0.163)], '422': [('Drama', 0.81), ('Comedy', 0.19)], '423': [('Drama', 0.556), ('Thriller', 0.444)], '424': [('Drama', 0.506), ('Thriller', 0.494)], '425': [('Drama', 0.634), ('Thriller', 0.366)], '426': [('Drama', 0.513), ('Comedy', 0.487)], '427': [('Drama', 0.626), ('Thriller', 0.374)], '428': [('Comedy', 0.573), ('Drama', 0.427)], '429': [('Drama', 0.588), ('Romance', 0.412)], '430': [('Drama', 0.721), ('Comedy', 0.279)], '431': [('Crime', 0.529), ('Comedy', 0.471)], '432': [('Drama', 0.703), ('Thriller', 0.297)], '433': [('Crime', 0.548), ('Drama', 0.452)], '434': [('Drama', 0.619), ('Action', 0.381)], '435': [('Drama', 0.648), ('Crime', 0.352)], '436': [('Drama', 0.636), ('Children', 0.364)], '437': [('Drama', 0.698), ('Comedy', 0.302)], '438': [('Action', 0.511), ('Drama', 0.489)], '439': [('Drama', 0.555), ('Adventure', 0.445)], '440': [('Drama', 0.525), ('Sci-Fi', 0.475)], '441': [('Comedy', 0.527), ('Action', 0.473)], '443': [('Drama', 0.656), ('Adventure', 0.344)], '444': [('Drama', 0.539), ('Crime', 0.461)], '445': [('Drama', 0.615), ('Comedy', 0.385)], '446': [('Drama', 0.621), ('Comedy', 0.379)], '447': [('Drama', 0.532), ('Thriller', 0.468)], '448': [('Comedy', 0.565), ('Drama', 0.435)], '449': [('Drama', 0.599), ('Crime', 0.401)], '450': [('Drama', 0.687), ('Action', 0.313)], '451': [('Comedy', 0.515), ('Thriller', 0.485)], '452': [('Action', 0.558), ('Thriller', 0.442)], '453': [('Comedy', 0.655), ('Drama', 0.345)], '454': [('Drama', 0.557), ('Horror', 0.443)], '455': [('Drama', 0.727), ('Romance', 0.273)], '456': [('Thriller', 0.5), ('Drama', 0.5)], '457': [('Comedy', 0.525), ('Action', 0.475)], '458': [('Drama', 0.554), ('Thriller', 0.446)], '459': [('Adventure', 0.527), ('Drama', 0.473)], '460': [('Drama', 0.694), ('Adventure', 0.306)], '461': [('Drama', 0.734), ('Crime', 0.266)], '462': [('Drama', 0.554), ('Documentary', 0.446)], '463': [('Drama', 0.555), ('Action', 0.445)], '464': [('Drama', 0.635), ('Thriller', 0.365)], '465': [('Thriller', 0.515), ('Drama', 0.485)], '466': [('Drama', 0.537), ('Adventure', 0.463)], '467': [('Drama', 0.684), ('War', 0.316)], '468': [('Drama', 0.658), ('Thriller', 0.342)], '469': [('Drama', 0.6), ('Comedy', 0.4)], '470': [('Drama', 0.646), ('Comedy', 0.354)], '471': [('Drama', 0.596), ('Comedy', 0.404)], '472': [('Drama', 0.705), ('Crime', 0.295)], '473': [('Drama', 0.722), ('Comedy', 0.278)], '474': [('Drama', 0.741), ('Comedy', 0.259)], '475': [('Adventure', 0.509), ('Action', 0.491)], '476': [('Drama', 0.691), ('Children', 0.309)], '477': [('Comedy', 0.526), ('Drama', 0.474)], '478': [('Action', 0.622), ('Adventure', 0.378)], '479': [('Comedy', 0.519), ('Drama', 0.481)], '480': [('Drama', 0.605), ('Comedy', 0.395)], '481': [('Drama', 0.551), ('Romance', 0.449)], '482': [('Action', 0.54), ('Comedy', 0.46)], '483': [('Comedy', 0.51), ('Drama', 0.49)], '484': [('Comedy', 0.748), ('Drama', 0.252)], '485': [('Thriller', 0.625), ('Drama', 0.375)], '486': [('Action', 0.505), ('Thriller', 0.495)], '487': [('Drama', 0.638), ('Adventure', 0.362)], '488': [('Comedy', 0.505), ('Drama', 0.495)], '489': [('Drama', 0.651), ('Comedy', 0.349)], '490': [('Drama', 0.784), ('Comedy', 0.216)], '491': [('Comedy', 0.691), ('Drama', 0.309)], '492': [('Comedy', 0.592), ('Thriller', 0.408)], '493': [('Action', 0.679), ('Drama', 0.321)], '494': [('Action', 0.624), ('Adventure', 0.376)], '495': [('Drama', 0.596), ('Comedy', 0.404)], '496': [('Drama', 0.699), ('Adventure', 0.301)], '497': [('Drama', 0.783), ('Comedy', 0.217)], '498': [('Comedy', 0.556), ('Drama', 0.444)], '499': [('Drama', 0.562), ('Western', 0.438)], '500': [('Comedy', 0.789), ('Romance', 0.211)], '501': [('Comedy', 0.66), ('Thriller', 0.34)], '502': [('Comedy', 0.54), ('Drama', 0.46)], '503': [('Drama', 0.787), ('Crime', 0.213)], '504': [('Drama', 0.59), ('Comedy', 0.41)], '505': [('Horror', 0.574), ('Thriller', 0.426)], '506': [('Drama', 0.581), ('Romance', 0.419)], '507': [('Thriller', 0.588), ('Romance', 0.412)], '508': [('Adventure', 0.5), ('Comedy', 0.5)], '509': [('Comedy', 0.609), ('Drama', 0.391)], '510': [('Comedy', 0.57), ('Drama', 0.43)], '511': [('Drama', 0.589), ('Sci-Fi', 0.411)], '512': [('Thriller', 0.526), ('Drama', 0.474)], '513': [('Drama', 0.631), ('Thriller', 0.369)], '514': [('Drama', 0.573), ('Comedy', 0.427)], '515': [('Drama', 0.548), ('Action', 0.452)], '516': [('Drama', 0.655), ('Adventure', 0.345)], '517': [('Drama', 0.647), ('Children', 0.353)], '518': [('Drama', 0.579), ('Comedy', 0.421)], '519': [('Comedy', 0.51), ('Drama', 0.49)], '520': [('Comedy', 0.665), ('Drama', 0.335)], '521': [('Drama', 0.669), ('Comedy', 0.331)], '522': [('Comedy', 0.541), ('Drama', 0.459)], '523': [('Drama', 0.646), ('Fantasy', 0.354)], '524': [('Action', 0.551), ('Adventure', 0.449)], '525': [('Comedy', 0.558), ('Drama', 0.442)], '526': [('Drama', 0.713), ('Comedy', 0.287)], '527': [('Adventure', 0.561), ('Drama', 0.439)], '528': [('Drama', 0.538), ('Thriller', 0.462)], '529': [('Action', 0.537), ('Thriller', 0.463)], '530': [('Thriller', 0.566), ('Drama', 0.434)], '531': [('Adventure', 0.589), ('Action', 0.411)], '532': [('Drama', 0.524), ('Action', 0.476)], '533': [('Horror', 0.676), ('Thriller', 0.324)], '534': [('Comedy', 0.511), ('Action', 0.489)], '535': [('Comedy', 0.608), ('Drama', 0.392)], '536': [('Drama', 0.722), ('Comedy', 0.278)], '537': [('Drama', 0.502), ('Crime', 0.498)], '538': [('Comedy', 0.645), ('Drama', 0.355)], '539': [('Comedy', 0.644), ('Adventure', 0.356)], '540': [('Action', 0.583), ('Sci-Fi', 0.417)], '541': [('Drama', 0.601), ('Thriller', 0.399)], '542': [('Comedy', 0.518), ('Drama', 0.482)], '543': [('Comedy', 0.763), ('Drama', 0.237)], '544': [('Drama', 0.605), ('Comedy', 0.395)], '545': [('Thriller', 0.58), ('Action', 0.42)], '546': [('Horror', 0.753), ('Comedy', 0.247)], '547': [('Comedy', 0.556), ('Drama', 0.444)], '548': [('Drama', 0.734), ('Comedy', 0.266)], '549': [('Action', 0.544), ('Thriller', 0.456)], '550': [('Sci-Fi', 0.545), ('Action', 0.455)], '551': [('Action', 0.527), ('Thriller', 0.473)], '552': [('Drama', 0.582), ('Comedy', 0.418)], '553': [('Drama', 0.557), ('Crime', 0.443)], '554': [('Drama', 0.712), ('Comedy', 0.288)], '555': [('Comedy', 0.604), ('Drama', 0.396)], '556': [('Fantasy', 0.527), ('Adventure', 0.473)], '557': [('Adventure', 0.532), ('Action', 0.468)], '558': [('Drama', 0.65), ('Comedy', 0.35)], '559': [('Drama', 0.66), ('Action', 0.34)], '560': [('Drama', 0.592), ('Comedy', 0.408)], '561': [('Comedy', 0.501), ('Action', 0.499)], '562': [('Drama', 0.612), ('Comedy', 0.388)], '563': [('Drama', 0.578), ('Comedy', 0.422)], '564': [('Comedy', 0.845), ('Romance', 0.155)], '565': [('Drama', 0.527), ('Thriller', 0.473)], '566': [('Drama', 0.531), ('Comedy', 0.469)], '567': [('Drama', 0.718), ('Sci-Fi', 0.282)], '568': [('Drama', 0.71), ('Comedy', 0.29)], '569': [('Action', 0.53), ('Thriller', 0.47)], '570': [('Drama', 0.589), ('Action', 0.411)], '571': [('Horror', 0.724), ('Thriller', 0.276)], '572': [('Drama', 0.669), ('Comedy', 0.331)], '573': [('Comedy', 0.571), ('Action', 0.429)], '574': [('Comedy', 0.503), ('Drama', 0.497)], '575': [('Comedy', 0.74), ('Drama', 0.26)], '576': [('Comedy', 0.569), ('Action', 0.431)], '577': [('Drama', 0.691), ('Action', 0.309)], '578': [('Drama', 0.571), ('Romance', 0.429)], '579': [('Drama', 0.509), ('Comedy', 0.491)], '580': [('Drama', 0.574), ('Action', 0.426)], '581': [('Drama', 0.703), ('Adventure', 0.297)], '582': [('Action', 0.552), ('Adventure', 0.448)], '583': [('Comedy', 0.648), ('Romance', 0.352)], '584': [('Drama', 0.527), ('Thriller', 0.473)], '585': [('Drama', 0.636), ('Crime', 0.364)], '586': [('Action', 0.504), ('Adventure', 0.496)], '587': [('Comedy', 0.556), ('Drama', 0.444)], '588': [('Drama', 0.61), ('Thriller', 0.39)], '589': [('Drama', 0.696), ('Thriller', 0.304)], '590': [('Drama', 0.748), ('Action', 0.252)], '591': [('Drama', 0.502), ('Comedy', 0.498)], '592': [('Action', 0.512), ('Comedy', 0.488)], '593': [('Drama', 0.644), ('Romance', 0.356)], '594': [('Romance', 0.525), ('Comedy', 0.475)], '595': [('Drama', 0.676), ('Comedy', 0.324)], '596': [('Drama', 0.516), ('Action', 0.484)], '597': [('Comedy', 0.52), ('Drama', 0.48)], '598': [('Drama', 0.506), ('Romance', 0.494)], '599': [('Drama', 0.645), ('Action', 0.355)], '600': [('Comedy', 0.607), ('Drama', 0.393)], '601': [('Drama', 0.665), ('Adventure', 0.335)], '602': [('Drama', 0.528), ('Thriller', 0.472)], '603': [('Drama', 0.702), ('Comedy', 0.298)], '604': [('Drama', 0.595), ('Thriller', 0.405)], '605': [('Comedy', 0.533), ('Adventure', 0.467)], '606': [('Drama', 0.694), ('Comedy', 0.306)], '607': [('Drama', 0.627), ('Thriller', 0.373)], '608': [('Drama', 0.606), ('Thriller', 0.394)], '609': [('Drama', 0.615), ('Thriller', 0.385)], '610': [('Drama', 0.565), ('Comedy', 0.435)]}

# 获得每部电影平均分
def get_avg(file):

    record = {}
    score = {}
    linenum = 0
    fp = open(file,encoding='utf-8')
    for line in fp:
        if linenum == 0:
            linenum += 1
            continue
        item = line.strip().split(",")

        userid, itemid, rating = item[0],item[1],float(item[2])
        if itemid not in record:
            record[itemid] = [0,0]
        record[itemid][0] += rating
        record[itemid][1] += 1
    fp.close()
    for itemid in record:
        score[itemid] = round(record[itemid][0]/record[itemid][1],3)
    return score


# 得到不同标签的电影的评分排序 和 同一电影的种类
#格式: item_cate[itemid]:{tag:ratio}
def get_item_cate(file, avg_score):

    record = {}
    item_cate = {}
    cate_item_sort = {}
    linenum = 0
    topk = 100
    if not os.path.exists(file):
        return {},{}
    fp = open(file,encoding='utf-8')
    for line in fp:
        if linenum == 0:
            linenum += 1
            continue
        item = line.strip().split(",")
        if(len(item) < 3):
            continue
        itemid = item[0]
        cate_str = item[-1]
        cate_list = cate_str.strip().split("|")
        ratio = round(1/len(cate_list),3)
        if itemid not in item_cate:
            item_cate[itemid] = {}
        for fix_cate in cate_list:
            item_cate[itemid][fix_cate] = ratio
    fp.close()

    for itemid in item_cate:
        for cate in item_cate[itemid]:
            if cate not in record:
                record[cate] = {}
            itemid_rating_score = avg_score.get(itemid,0)
            record[cate][itemid] = itemid_rating_score
    for cate in record:
        if cate not in cate_item_sort:
            cate_item_sort[cate] = []
        for combo in sorted(record[cate].items(),key=operator.itemgetter(1),reverse=True)[:topk]:
            cate_item_sort[cate].append((combo[0],float(combo[1])))
    return item_cate, cate_item_sort

# 获得值最大的时间戳,以便计算时间戳的权重
def get_latest_timestamp():


    file="./ratings.csv"
    linenum = 0
    latest = 0
    fp = open(file,encoding='utf-8')
    for line in fp:
        if linenum == 0:
            linenum += 1
            continue
        item = line.strip().split(",")
        if len(item) < 4:
            continue
        timestamp = int(item[3])
        if timestamp > latest:
            latest = timestamp
    fp.close()

    return latest


# 返回时间的得分
def get_time_score(time):

    fix_time_stamp = int(get_latest_timestamp())
    total_sec = 24*60*60
    delta = (fix_time_stamp-time)/total_sec/100
    return round(1/(1+delta),3)

# 获取数据
def get_data():
    file = open('./merged.csv','r',encoding='utf-8')

    data = {}
    linenum=0
    for line in file.readlines():

        if linenum==0:
            linenum+=1
            continue
        line = line.strip().split(',')

        if not line[0] in data.keys():
            data[line[0]] = {line[2]:float(line[1])}

        else:
            data[line[0]][line[2]] = float(line[1])
    return data
